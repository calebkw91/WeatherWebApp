<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Playfair+Display:400,600%7CFira+Sans:300,400,400i,600">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

    <link rel="stylesheet" href="assets/css/style.css">

    <title>Weather</title>
</head>

<div id="page-container">
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">Weather</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto"></div>
        <form class="form-inline my-2 my-lg-0" id="location-search">
          <input class="form-control mr-sm-2" id="location-input" type="search" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
      </div>
  </nav>

  <main id="main">
    <div class="container">
      <div class="row">
        <div class="col-9">

          <div class="row">
            <div class="card" style="width: 100%;">
              <h5 class="card-header" id="location-name">Location</h5>
              <div class="card-body">
                <div class="row">
                  <div class="col-4">
                    <h5 class="card-title" id="current-temp">Current Temp</h5>
                    <img src="" id="weather-condition" alt="weather condition">
                  </div>
                  <div class="col-4">
                    <ul>
                      <li id="feels-like">Feels Like</li>
                      <li id="temp-high">High</li>
                      <li id="temp-low">Low</li>
                    </ul>
                  </div>
                  <div class="col-4">
                    <ul>
                      <li id="current-humidity">Humidity</li>
                      <li id="current-wind">Wind</li>
                      <!-- <li id="current-precip">Precip</li> -->
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="card" style="width: 20%">
              <h5 class="card-title" id="day0" style="text-align: center;">Card title</h5>
              <img src="..." class="card-img-top" alt="..." id="conditions0">
              <div class="card-body">
                <p class="card-text" id="temp-day0">Weather</p>
              </div>
              <ul class="list-group list-group-flush">
                <li class="list-group-item" id="precip-day0">Temp</li>
                <li class="list-group-item" id="wind-day0">Wind</li>
                <li class="list-group-item" id="humidity-day0">Humidity</li>
              </ul>
            </div>
            <div class="card" style="width: 20%">
              <h5 class="card-title" id="day1" style="text-align: center;">Card title</h5>
              <img src="..." class="card-img-top" alt="..." id="conditions1">
              <div class="card-body">
                <p class="card-text" id="temp-day1">Weather</p>
              </div>
              <ul class="list-group list-group-flush">
                <li class="list-group-item" id="precip-day1">Temp</li>
                <li class="list-group-item" id="wind-day1">Wind</li>
                <li class="list-group-item" id="humidity-day1">Humidity</li>
              </ul>
            </div>
            <div class="card" style="width: 20%">
              <h5 class="card-title" id="day2" style="text-align: center;">Card title</h5>
              <img src="..." class="card-img-top" alt="..." id="conditions2">
              <div class="card-body">
                <p class="card-text" id="temp-day2">Weather</p>
              </div>
              <ul class="list-group list-group-flush">
                <li class="list-group-item" id="precip-day2">Temp</li>
                <li class="list-group-item" id="wind-day2">Wind</li>
                <li class="list-group-item" id="humidity-day2">Humidity</li>
              </ul>
            </div>
            <div class="card" style="width: 20%">
              <h5 class="card-title" id="day3" style="text-align: center;">Card title</h5>
              <img src="..." class="card-img-top" alt="..." id="conditions3">
              <div class="card-body">
                <p class="card-text" id="temp-day3">Weather</p>
              </div>
              <ul class="list-group list-group-flush">
                <li class="list-group-item" id="precip-day3">Temp</li>
                <li class="list-group-item" id="wind-day3">Wind</li>
                <li class="list-group-item" id="humidity-day3">Humidity</li>
              </ul>
            </div>
            <div class="card" style="width: 20%">
              <h5 class="card-title" id="day4" style="text-align: center;">Card title</h5>
              <img src="..." class="card-img-top" alt="..." id="conditions4">
              <div class="card-body">
                <p class="card-text" id="temp-day4">Weather</p>
              </div>
              <ul class="list-group list-group-flush">
                <li class="list-group-item" id="precip-day4">Temp</li>
                <li class="list-group-item" id="wind-day4">Wind</li>
                <li class="list-group-item" id="humidity-day4">Humidity</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="col-3">
          <div class="list-group" id="location-buttons"></div>
        </div>

      </div>
    </div>
  </main>
    
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
<script src="assets/js/script.js"></script>

<script>

  setDayTitle();

  function kelvinToFahrenheit(temp)
  {
    let tempInt = parseInt(temp);
    let fTemp = ((tempInt - 273.15)*9/5 + 32).toFixed(1);
  
    return fTemp;
  }

  function createLocationButton(location)
  {
    resetActiveButton();
    let newBtn = $("<button>");
    newBtn.attr("type", "button");
    newBtn.addClass("list-group-item list-group-item-action location-button active");
    newBtn.text(location);
    newBtn.attr("data-location", location);
    $("#location-buttons").prepend(newBtn);
  }

  function resetActiveButton()
  {
    $("button").each(function()
    {
      $(this).removeClass("active");
    })
  }

  function setDayTitle()
  {
    $("#day0").text(moment().format("dddd"));
    $("#day1").text(moment().add(1, 'd').format("dddd"));
    $("#day2").text(moment().add(2, 'd').format("dddd"));
    $("#day3").text(moment().add(3, 'd').format("dddd"));
    $("#day4").text(moment().add(4, 'd').format("dddd"));
  }

  function windDirection(degreesString)
  {
    let direction = "";
    let degrees = parseInt(degreesString);

    if (degrees < 22.5 || degrees > 337.5)
    {
     direction = "N"; 
    }
    else if (degrees >= 22.5 || degrees <= 67.5)
    {
     direction = "NE"; 
    }
    else if (degrees > 67.5 || degrees <= 112.5)
    {
     direction = "E"; 
    }
    else if (degrees > 112.5 || degrees <= 157.5)
    {
     direction = "SE"; 
    }
    else if (degrees > 157.5 || degrees <= 202.5)
    {
     direction = "S"; 
    }
    else if (degrees > 202.5 || degrees <= 247.5)
    {
     direction = "SW"; 
    }
    else if (degrees > 247.5 || degrees <= 295.5)
    {
     direction = "W"; 
    }
    else if (degrees > 295.5 || degrees <= 337.5)
    {
     direction = "W"; 
    }

    return direction;
  }

  function pullWeatherData(location, newBtn)
  {
    let params = 
    {
      q: location,
      cnt: 5,
      appid: "87cd2f3bae194c48a4c4081e9ab09c49"
    }

    params = $.param(params);

    let queryURL = "https://api.openweathermap.org/data/2.5/weather?" + params;

    $.ajax(
    {
        url: queryURL,
        method: "GET"
    })
    .then(function(response) 
    {
        let forecast = response;

        if (newBtn)
        {
          createLocationButton(forecast.name);
        }

        $("#location-name").text(forecast.name);
        $("#current-temp").text("Current: " + kelvinToFahrenheit(forecast.main.temp) + '\u00B0' + "F");
        $("#feels-like").text("Feels like: " + kelvinToFahrenheit(forecast.main.feels_like) + '\u00B0' + "F");
        $("#current-humidity").text("Humidity: " + forecast.main.humidity + "%");
        $("#current-wind").text("Wind: " + forecast.wind.speed + windDirection(forecast.wind.deg));
        $("#weather-condition").attr("src", "http://openweathermap.org/img/wn/" + forecast.weather[0].icon + "@2x.png")

        let paramsWeek = 
        {
          lat: forecast.coord.lat,
          lon: forecast.coord.lon,
          exclude: "current,minutely,hourly",
          appid: "87cd2f3bae194c48a4c4081e9ab09c49"
        }

        paramsWeek = $.param(paramsWeek);

        let queryURLWeek = "https://api.openweathermap.org/data/2.5/onecall?" + paramsWeek;
        console.log(queryURLWeek);

        $.ajax(
        {
            url: queryURLWeek,
            method: "GET"
        })
        .then(function(response) 
        {
            console.log(response);
            let forecast = response;

            $("#temp-high").text("High: " + kelvinToFahrenheit(forecast.daily[0].temp.max) + '\u00B0' + "F");
            $("#temp-low").text("Low: " + kelvinToFahrenheit(forecast.daily[0].temp.min) + '\u00B0' + "F");

            for (i=0; i<5; i++)
            {
              $("#conditions" + i).attr("src", "http://openweathermap.org/img/wn/" + forecast.daily[i].weather[0].icon + "@2x.png")
              $("#temp-day" + i).text(kelvinToFahrenheit(forecast.daily[i].temp.max) + "/" + kelvinToFahrenheit(forecast.daily[i].temp.min) + '\u00B0' + "F");
              $("#humidity-day" + i).text("Humidity: " + forecast.daily[i].humidity + "%");
              $("#wind-day" + i).text("Wind: " + forecast.daily[i].wind_speed + windDirection(forecast.daily[i].wind_deg));
              $("#precip-day" + i).text("Precip: " + forecast.daily[i].pop + "%");
            }
        });
    });
  }

  $(document).on("click", ".location-button", function()
  {
    let location = $(this).attr("data-location");
    resetActiveButton();
    $(this).addClass("active");
    pullWeatherData(location, false);
  })

  $("#location-search").on("submit", function(event)
  {
    event.preventDefault();

    let location = $("#location-input").val();
    $("#location-input").val("");

    pullWeatherData(location, true);
  })

</script>

</html>